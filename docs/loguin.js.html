<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>loguin.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-cargarDrive.html">cargarDrive</a><ul class='methods'><li data-type='method'><a href="module-cargarDrive.html#~saveFile">saveFile</a></li></ul></li><li><a href="module-codigoGS.html">codigoGS</a><ul class='methods'><li data-type='method'><a href="module-codigoGS.html#~checkPoliticas">checkPoliticas</a></li><li data-type='method'><a href="module-codigoGS.html#~findData">findData</a></li><li data-type='method'><a href="module-codigoGS.html#~findData2">findData2</a></li><li data-type='method'><a href="module-codigoGS.html#~findDataRegistro">findDataRegistro</a></li><li data-type='method'><a href="module-codigoGS.html#~getJSON">getJSON</a></li><li data-type='method'><a href="module-codigoGS.html#~include">include</a></li><li data-type='method'><a href="module-codigoGS.html#~listas">listas</a></li><li data-type='method'><a href="module-codigoGS.html#~politicas">politicas</a></li><li data-type='method'><a href="module-codigoGS.html#~postInDB">postInDB</a></li><li data-type='method'><a href="module-codigoGS.html#~userDatos">userDatos</a></li><li data-type='method'><a href="module-codigoGS.html#~userId">userId</a></li></ul></li><li><a href="module-codigoGS2.html">codigoGS2</a><ul class='methods'><li data-type='method'><a href="module-codigoGS2.html#~fechas">fechas</a></li><li data-type='method'><a href="module-codigoGS2.html#~findData3">findData3</a></li><li data-type='method'><a href="module-codigoGS2.html#~findDataRegistro2">findDataRegistro2</a></li><li data-type='method'><a href="module-codigoGS2.html#~postInDB">postInDB</a></li></ul></li><li><a href="module-loguin.html">loguin</a><ul class='methods'><li data-type='method'><a href="module-loguin.html#~checkLogin">checkLogin</a></li><li data-type='method'><a href="module-loguin.html#~doGet">doGet</a></li><li data-type='method'><a href="module-loguin.html#~doPost">doPost</a></li><li data-type='method'><a href="module-loguin.html#~PutValues">PutValues</a></li><li data-type='method'><a href="module-loguin.html#~ShowValues">ShowValues</a></li></ul></li><li><a href="module-scriptExperiencia.html">scriptExperiencia</a><ul class='methods'><li data-type='method'><a href="module-scriptExperiencia.html#~agregar">agregar</a></li><li data-type='method'><a href="module-scriptExperiencia.html#~aplicarFormacion">aplicarFormacion</a></li><li data-type='method'><a href="module-scriptExperiencia.html#~barraProgreso">barraProgreso</a></li><li data-type='method'><a href="module-scriptExperiencia.html#~datosPersonas">datosPersonas</a></li><li data-type='method'><a href="module-scriptExperiencia.html#~deleteExperiencia">deleteExperiencia</a></li><li data-type='method'><a href="module-scriptExperiencia.html#~editarExperiencia">editarExperiencia</a></li><li data-type='method'><a href="module-scriptExperiencia.html#~filedForm">filedForm</a></li><li data-type='method'><a href="module-scriptExperiencia.html#~guardarInfo">guardarInfo</a></li><li data-type='method'><a href="module-scriptExperiencia.html#~iniciar">iniciar</a></li><li data-type='method'><a href="module-scriptExperiencia.html#~limpiarForm">limpiarForm</a></li><li data-type='method'><a href="module-scriptExperiencia.html#~perfil">perfil</a></li><li data-type='method'><a href="module-scriptExperiencia.html#~progreso">progreso</a></li><li data-type='method'><a href="module-scriptExperiencia.html#~saveFile">saveFile</a></li><li data-type='method'><a href="module-scriptExperiencia.html#~scrollFunction">scrollFunction</a></li><li data-type='method'><a href="module-scriptExperiencia.html#~tablaVinculados">tablaVinculados</a></li></ul></li><li><a href="module-scriptFormacion.html">scriptFormacion</a><ul class='methods'><li data-type='method'><a href="module-scriptFormacion.html#~agregar">agregar</a></li><li data-type='method'><a href="module-scriptFormacion.html#~alertaMsn">alertaMsn</a></li><li data-type='method'><a href="module-scriptFormacion.html#~aplicarFormacion">aplicarFormacion</a></li><li data-type='method'><a href="module-scriptFormacion.html#~arrayObjetos">arrayObjetos</a></li><li data-type='method'><a href="module-scriptFormacion.html#~barraProgreso">barraProgreso</a></li><li data-type='method'><a href="module-scriptFormacion.html#~cargarInfo">cargarInfo</a></li><li data-type='method'><a href="module-scriptFormacion.html#~datosPersonas">datosPersonas</a></li><li data-type='method'><a href="module-scriptFormacion.html#~deleteFormacion">deleteFormacion</a></li><li data-type='method'><a href="module-scriptFormacion.html#~editarFormacion">editarFormacion</a></li><li data-type='method'><a href="module-scriptFormacion.html#~filedForm">filedForm</a></li><li data-type='method'><a href="module-scriptFormacion.html#~guardarInfo">guardarInfo</a></li><li data-type='method'><a href="module-scriptFormacion.html#~iniciar">iniciar</a></li><li data-type='method'><a href="module-scriptFormacion.html#~limpiarForm">limpiarForm</a></li><li data-type='method'><a href="module-scriptFormacion.html#~perfil">perfil</a></li><li data-type='method'><a href="module-scriptFormacion.html#~progreso">progreso</a></li><li data-type='method'><a href="module-scriptFormacion.html#~saveFile">saveFile</a></li><li data-type='method'><a href="module-scriptFormacion.html#~tablaVinculados">tablaVinculados</a></li><li data-type='method'><a href="module-scriptFormacion.html#~validacionAdjunto">validacionAdjunto</a></li><li data-type='method'><a href="module-scriptFormacion.html#~validacionEstudios">validacionEstudios</a></li><li data-type='method'><a href="module-scriptFormacion.html#~validacionTarjeta">validacionTarjeta</a></li></ul></li><li><a href="module-scriptHome.html">scriptHome</a><ul class='methods'><li data-type='method'><a href="module-scriptHome.html#~aceptar">aceptar</a></li><li data-type='method'><a href="module-scriptHome.html#~checkPoliticas">checkPoliticas</a></li></ul></li><li><a href="module-scriptInfoLab.html">scriptInfoLab</a><ul class='methods'><li data-type='method'><a href="module-scriptInfoLab.html#~alertaError">alertaError</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~backToTop">backToTop</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~barraProgreso">barraProgreso</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~cedulaInfoLab">cedulaInfoLab</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~datosInfoLab">datosInfoLab</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~deleteConocimiento">deleteConocimiento</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~especialidadList">especialidadList</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~filedForm">filedForm</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~objeto">objeto</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~perfil">perfil</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~post">post</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~postData">postData</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~progreso">progreso</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~saveFile">saveFile</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~scrollFunction">scrollFunction</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~tablaEspecialidad">tablaEspecialidad</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~tipoList">tipoList</a></li><li data-type='method'><a href="module-scriptInfoLab.html#~validacion">validacion</a></li></ul></li><li><a href="module-scriptIngresos.html">scriptIngresos</a><ul class='methods'><li data-type='method'><a href="module-scriptIngresos.html#~alertaError">alertaError</a></li><li data-type='method'><a href="module-scriptIngresos.html#~backToTop">backToTop</a></li><li data-type='method'><a href="module-scriptIngresos.html#~barraProgreso">barraProgreso</a></li><li data-type='method'><a href="module-scriptIngresos.html#~cedulaIngresos">cedulaIngresos</a></li><li data-type='method'><a href="module-scriptIngresos.html#~datosPerfil">datosPerfil</a></li><li data-type='method'><a href="module-scriptIngresos.html#~filedForm">filedForm</a></li><li data-type='method'><a href="module-scriptIngresos.html#~perfil">perfil</a></li><li data-type='method'><a href="module-scriptIngresos.html#~postData">postData</a></li><li data-type='method'><a href="module-scriptIngresos.html#~progreso">progreso</a></li><li data-type='method'><a href="module-scriptIngresos.html#~scrollFunction">scrollFunction</a></li></ul></li><li><a href="module-scriptLoguin.html">scriptLoguin</a><ul class='methods'><li data-type='method'><a href="module-scriptLoguin.html#~mostrarPassword">mostrarPassword</a></li></ul></li><li><a href="module-scriptMapa.html">scriptMapa</a><ul class='methods'><li data-type='method'><a href="module-scriptMapa.html#~alertaError">alertaError</a></li><li data-type='method'><a href="module-scriptMapa.html#~backToTop">backToTop</a></li><li data-type='method'><a href="module-scriptMapa.html#~barraProgreso">barraProgreso</a></li><li data-type='method'><a href="module-scriptMapa.html#~cedulaMapa">cedulaMapa</a></li><li data-type='method'><a href="module-scriptMapa.html#~datosMapa">datosMapa</a></li><li data-type='method'><a href="module-scriptMapa.html#~deleteConocimiento">deleteConocimiento</a></li><li data-type='method'><a href="module-scriptMapa.html#~filedForm">filedForm</a></li><li data-type='method'><a href="module-scriptMapa.html#~objeto">objeto</a></li><li data-type='method'><a href="module-scriptMapa.html#~perfil">perfil</a></li><li data-type='method'><a href="module-scriptMapa.html#~post">post</a></li><li data-type='method'><a href="module-scriptMapa.html#~postData">postData</a></li><li data-type='method'><a href="module-scriptMapa.html#~progreso">progreso</a></li><li data-type='method'><a href="module-scriptMapa.html#~saveFile">saveFile</a></li><li data-type='method'><a href="module-scriptMapa.html#~scrollFunction">scrollFunction</a></li><li data-type='method'><a href="module-scriptMapa.html#~tablaConocimientos">tablaConocimientos</a></li><li data-type='method'><a href="module-scriptMapa.html#~validacion">validacion</a></li></ul></li><li><a href="module-scriptRegistro.html">scriptRegistro</a><ul class='methods'><li data-type='method'><a href="module-scriptRegistro.html#~alertaError">alertaError</a></li><li data-type='method'><a href="module-scriptRegistro.html#~alertaYellow">alertaYellow</a></li><li data-type='method'><a href="module-scriptRegistro.html#~backToTop">backToTop</a></li><li data-type='method'><a href="module-scriptRegistro.html#~barraProgreso">barraProgreso</a></li><li data-type='method'><a href="module-scriptRegistro.html#~botonAddPersonas">botonAddPersonas</a></li><li data-type='method'><a href="module-scriptRegistro.html#~datosHijos">datosHijos</a></li><li data-type='method'><a href="module-scriptRegistro.html#~datosPerfil">datosPerfil</a></li><li data-type='method'><a href="module-scriptRegistro.html#~datosPersonas">datosPersonas</a></li><li data-type='method'><a href="module-scriptRegistro.html#~deleteHijo">deleteHijo</a></li><li data-type='method'><a href="module-scriptRegistro.html#~deletePersona">deletePersona</a></li><li data-type='method'><a href="module-scriptRegistro.html#~enableInput">enableInput</a></li><li data-type='method'><a href="module-scriptRegistro.html#~filedForm">filedForm</a></li><li data-type='method'><a href="module-scriptRegistro.html#~filedFormHijos">filedFormHijos</a></li><li data-type='method'><a href="module-scriptRegistro.html#~filedFormPersonas">filedFormPersonas</a></li><li data-type='method'><a href="module-scriptRegistro.html#~formPersonas">formPersonas</a></li><li data-type='method'><a href="module-scriptRegistro.html#~perfil">perfil</a></li><li data-type='method'><a href="module-scriptRegistro.html#~postData">postData</a></li><li data-type='method'><a href="module-scriptRegistro.html#~progreso">progreso</a></li><li data-type='method'><a href="module-scriptRegistro.html#~scrollFunction">scrollFunction</a></li><li data-type='method'><a href="module-scriptRegistro.html#~tablaHijos">tablaHijos</a></li><li data-type='method'><a href="module-scriptRegistro.html#~tablaVinculados">tablaVinculados</a></li><li data-type='method'><a href="module-scriptRegistro.html#~validarHijos">validarHijos</a></li><li data-type='method'><a href="module-scriptRegistro.html#~validarPersonas">validarPersonas</a></li></ul></li><li><a href="module-scriptVivienda.html">scriptVivienda</a><ul class='methods'><li data-type='method'><a href="module-scriptVivienda.html#~alertaError">alertaError</a></li><li data-type='method'><a href="module-scriptVivienda.html#~backToTop">backToTop</a></li><li data-type='method'><a href="module-scriptVivienda.html#~barraProgreso">barraProgreso</a></li><li data-type='method'><a href="module-scriptVivienda.html#~cedulaVivienda">cedulaVivienda</a></li><li data-type='method'><a href="module-scriptVivienda.html#~datosPerfil">datosPerfil</a></li><li data-type='method'><a href="module-scriptVivienda.html#~filedForm">filedForm</a></li><li data-type='method'><a href="module-scriptVivienda.html#~getJSON">getJSON</a></li><li data-type='method'><a href="module-scriptVivienda.html#~perfil">perfil</a></li><li data-type='method'><a href="module-scriptVivienda.html#~postData">postData</a></li><li data-type='method'><a href="module-scriptVivienda.html#~progreso">progreso</a></li><li data-type='method'><a href="module-scriptVivienda.html#~scrollFunction">scrollFunction</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">loguin.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * loguin(gs)
 * @module loguin
 */

var configuracion = "Usuarios";
var datos = {};

/**
 * Inicia la llamada de la pagina y recibe peticiones de tipo GET.
 * @param {object} e Parametro tipo objeto obtenido de la peticion get por protocolo http.
 * @returns {html} Retorna la página html que contenga el parametro e, si no trae parametro retorna index.
 */
function doGet(e) {

    var page = e.parameter.p || 'index';
    PutValues("", "", "");

    var html = HtmlService.createTemplateFromFile(page);
    html.mensaje = "";

    return html.evaluate()
        .setSandboxMode(HtmlService.SandboxMode.IFRAME)
        .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL)
        .addMetaTag('viewport', 'width=device-width, initial-scale=1, maximum-scale=2.0, user-scalable=yes')
        .setTitle('DATATALENTO')
        .setFaviconUrl('https://drive.google.com/uc?id=11VmVU-VhcrAi-_GjaxM048OZoL-2WpeM#.ico');

}
//Close función doGet

/**
 * Recibe peticiones y parametros de tipo POST
 * @param {object} e parametro tipo objeto obtenido de la petición Post por protocolo http
 * @returns {html} retorna la página html que contenga el parametro e, o en su defecto la página que se envie segun las validaciones.
 */
function doPost(e) {

    var ss = SpreadsheetApp.openById(ssId);
    var db = ss.getSheetByName("Registro");
    var data = db.getDataRange().getValues();

    var user = e.parameter.username || " ";
    var password = e.parameter.password || " ";


    datos = checkLogin(user, password);

    if (datos.sw) {

        //Enviamos los datos a la memoria cache
        PutValues(datos.correo, datos.nombre, datos.contrasena);
        ShowValues();

        var page = e.parameter.btnLogin || 'Home';

        var html = HtmlService.createTemplateFromFile(page);
        html.mensaje = "";
        return html.evaluate()
            .setSandboxMode(HtmlService.SandboxMode.IFRAME)
            .addMetaTag('viewport', 'width=device-width, initial-scale=1, maximum-scale=2.0, user-scalable=yes')
            .setTitle('DATATALENTO')
            .setFaviconUrl('https://drive.google.com/uc?id=11VmVU-VhcrAi-_GjaxM048OZoL-2WpeM#.ico');


    } else if (e.parameter.btnLogin != "") {


        var cacheVal = ShowValues();
        var datos = checkLogin(cacheVal.email, cacheVal.pass);
        var politicas = checkPoliticas()


        if (datos.sw &amp;&amp; e.parameter.btnLogin == "index") {
            PutValues("", "", "");
            var page = 'index';

            var html = HtmlService.createTemplateFromFile(page);
            html.mensaje = "";
            return html.evaluate()
                .setSandboxMode(HtmlService.SandboxMode.IFRAME)
                .addMetaTag('viewport', 'width=device-width, initial-scale=1, maximum-scale=2.0, user-scalable=yes')
                .setTitle('DATATALENTO')
                .setFaviconUrl('https://drive.google.com/uc?id=11VmVU-VhcrAi-_GjaxM048OZoL-2WpeM#.ico');


        } else if (datos.sw) {
            var userData = userDatos()

            if (userData.cedula != "") {
                var page = e.parameter.btnLogin;
            } else {
                var page = "registro";
            }


            var html = HtmlService.createTemplateFromFile(page);
            html.mensaje = "";
            return html.evaluate()
                .setSandboxMode(HtmlService.SandboxMode.IFRAME)
                .addMetaTag('viewport', 'width=device-width, initial-scale=1, maximum-scale=2.0, user-scalable=yes')
                .setTitle('DATATALENTO')
                .setFaviconUrl('https://drive.google.com/uc?id=11VmVU-VhcrAi-_GjaxM048OZoL-2WpeM#.ico');

        } else {

            var page = 'index';
            PutValues("", "", "");

            var html = HtmlService.createTemplateFromFile(page);
            html.mensaje = "";
            return html.evaluate()
                .setSandboxMode(HtmlService.SandboxMode.IFRAME)
                .addMetaTag('viewport', 'width=device-width, initial-scale=1, maximum-scale=2.0, user-scalable=yes')
                .setTitle('DATATALENTO')
                .setFaviconUrl('https://drive.google.com/uc?id=11VmVU-VhcrAi-_GjaxM048OZoL-2WpeM#.ico');


        }

    } else if (datos.sw == false &amp;&amp; user == " " || password == " ") {

        var page = 'index';
        PutValues("", "", "");

        var html = HtmlService.createTemplateFromFile(page);
        html.mensaje = "El campo de usuario o contraseña se encuentra vacío";
        return html.evaluate()
            .setSandboxMode(HtmlService.SandboxMode.IFRAME)
            .addMetaTag('viewport', 'width=device-width, initial-scale=1, maximum-scale=2.0, user-scalable=yes')
            .setTitle('DATATALENTO')
            .setFaviconUrl('https://drive.google.com/uc?id=11VmVU-VhcrAi-_GjaxM048OZoL-2WpeM#.ico');


    } else {

        var page = 'index';
        PutValues("", "", "");

        var html = HtmlService.createTemplateFromFile(page);
        html.mensaje = "Usuario o contraseña incorrectos";
        return html.evaluate()
            .setSandboxMode(HtmlService.SandboxMode.IFRAME)
            .addMetaTag('viewport', 'width=device-width, initial-scale=1, maximum-scale=2.0, user-scalable=yes')
            .setTitle('DATATALENTO')
            .setFaviconUrl('https://drive.google.com/uc?id=11VmVU-VhcrAi-_GjaxM048OZoL-2WpeM#.ico');

    }
}
//Close función POST


/**
 * Valida si el usuario y la contraseña ingresados en el input son iguales a los de la base de datos.
 * @param {string} user usuarion obtenido desde el frontend o desde memoria cache para ser validado con la base de datos.
 * @param {string} password contraseña obtenida desde el frontend o desde memoria cache para ser validada con la base de datos.
 * @returns {object} Retorna un objeto con los datos y el estado actual de loguin.
 */
function checkLogin(user, password) {

    var spreadsheet = SpreadsheetApp.openById(ssId);
    var sheeta = spreadsheet.getSheetByName(configuracion);
    var LastR = sheeta.getLastRow();
    var datos = sheeta.getDataRange().getValues();
    var longitud = sheeta.getRange("A2:A" + LastR).getValues();

    var sw = false;

    for (var i = 0; i &lt;= longitud.length; i++) {

        let apellido1 = datos[i][1];
        let apellido2 = datos[i][2];
        let nom = datos[i][3];
        let correo = datos[i][4];
        let contrasena = datos[i][5];

        let nombre = nom + " " + apellido1 + " " + apellido2

        var obj = {

            nombre: nombre,
            correo: correo,
            contrasena: contrasena,
            sw: sw

        };



        if (correo != "" &amp;&amp; user != "" &amp;&amp; password != "" &amp;&amp; contrasena != "") {
            //if (usuario.toUpperCase() == user.toUpperCase() &amp;&amp; password == contrasena) {
            if (correo == user &amp;&amp; password == contrasena) {

                sw = true;
                break;
            }
        } else {
            obj.sw = false;
        }
    }//Close for

    if (sw == true) {
        obj.sw = sw;
        return obj;

    } else {
        obj.sw = sw;
        return obj;
    }
}
//Close checkLogin



/**
 * Envia los datos obtenidos por parametros y los almacena durante el tiempo definido en la memoria cahce.
 * @function PutValues
 * @param {string} email correo del usuario logueado
 * @param {string} name nombre del usuario logueado
 * @param {string} password contraseña del usuario logueado
 */
function PutValues(email, name, password) {

    var cache = CacheService.getUserCache();

    //Se guardan los datos en cache durante 4 horas
    cache.put("EMAIL", email, 14400);
    cache.put("NAME", name, 14400);
    cache.put("PASS", password, 14400);

}
//Close putValues



//Esta función obtiene los datos guardados en la memoria cahce
/**
 * Obtiene los datos guardados en la memoria cache.
 * @function ShowValues
 * @returns {object} Retorna un objeto con los datos del usuario logueado.
 */
function ShowValues() {

    var cache = CacheService.getUserCache();

    var email = cache.get("EMAIL");
    var name = cache.get("NAME");
    var pass = cache.get("PASS");

    var objVal = {
        email: email,
        name: name,
        pass: pass,

    };
    return objVal;
}
//Close ShowValues




</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Wed Oct 13 2021 09:52:21 GMT-0500 (hora estándar de Colombia) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
